<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Manajemen Stok Barang</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:'Segoe UI',sans-serif;background:#f4f6f8;margin:0}
header{background:#2c3e50;color:#fff;padding:12px;text-align:center}
nav{display:flex;justify-content:center;gap:20px;background:#34495e}
nav button{background:none;border:none;color:#fff;padding:12px 18px;cursor:pointer;font-size:1rem}
nav button.active{border-bottom:3px solid #1abc9c}
section{max-width:1000px;margin:20px auto;padding:20px;background:#fff;border-radius:8px;box-shadow:0 3px 6px rgba(0,0,0,.1)}
h2{color:#2c3e50;text-align:center}
input,select{padding:8px;border:1px solid #ccc;border-radius:5px;margin-top:6px;width:100%}
button{background:#2980b9;color:#fff;border:none;padding:10px 15px;border-radius:5px;margin-top:10px;cursor:pointer}
button:hover{background:#1c5980}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:center}
th{background:#3498db;color:#fff}
tr.stok-rendah{background:#ffe6e6}
.warning{color:red;font-weight:bold;animation:blink 1s infinite}
@keyframes blink{50%{opacity:0}}
.hidden{display:none}
.chart-container{width:100%;height:300px}
.login-box{max-width:400px;margin:100px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 3px 6px rgba(0,0,0,.1)}
</style>
</head>
<body>
<header><h1>üì¶ Manajemen Stok Barang</h1></header>
<div id="loginSection" class="login-box">
  <h2>Login</h2>
  <label>Username</label><input id="username" type="text">
  <label>Password</label><input id="password" type="password">
  <button onclick="login()">Login</button>
  <p id="loginError" class="warning hidden">Username/Password salah</p>
</div>
<div id="appSection" class="hidden">
  <nav>
    <button onclick="showTab('home')" id="tab-home" class="active">üè† Home</button>
    <button onclick="showTab('masuk')" id="tab-masuk">‚ûï Barang Masuk</button>
    <button onclick="showTab('keluar')" id="tab-keluar">‚ûñ Barang Keluar</button>
  </nav>
  <section id="homeTab">
    <h2>Ringkasan</h2>
    <div class="chart-container"><canvas id="stokChart"></canvas></div>
    <h3>Pengguna & Role</h3>
    <p id="userInfo"></p>
    <button onclick="exportCSV()">Ekspor CSV</button>
    <button onclick="exportExcel()">Ekspor Excel</button>
  </section>
  <section id="masukTab" class="hidden">
    <h2>Barang Masuk</h2>
    <label>Nama Barang</label><input id="inputNama">
    <label>Jumlah</label><input id="inputJumlah" type="number" min="1">
    <button onclick="tambahBarang(true)">Tambah Barang Masuk</button>
    <div class="chart-container"><canvas id="masukChart"></canvas></div>
  </section>
  <section id="keluarTab" class="hidden">
    <h2>Barang Keluar</h2>
    <label>Nama Barang</label><input id="outputNama">
    <label>Jumlah</label><input id="outputJumlah" type="number" min="1">
    <button onclick="tambahBarang(false)">Tambah Barang Keluar</button>
    <button onclick="undoTransaksi()">‚è™ Undo Transaksi Terakhir</button>
    <h3>Stok Saat Ini</h3>
    <input id="searchInput" placeholder="Cari barang..." oninput="updateTabel()">
    <table><thead><tr><th>Nama</th><th>Stok</th><th>Status</th></tr></thead><tbody id="stokTableBody"></tbody></table>
    <h3>Histori Transaksi</h3>
    <label>Filter Tanggal</label><input type="date" id="filterStart"> - <input type="date" id="filterEnd"><button onclick="updateLog()">Filter</button>
    <table><thead><tr><th>Waktu</th><th>Jenis</th><th>Nama</th><th>Jumlah</th></tr></thead><tbody id="logTableBody"></tbody></table>
  </section>
</div>
<script>
const users={admin:{pass:"admin123",role:"Admin"},viewer:{pass:"view123",role:"Viewer"}};
let currentUser=null;
let stok=JSON.parse(localStorage.getItem('stokBarang'))||{};
let logTransaksi=JSON.parse(localStorage.getItem('logTransaksi'))||[];
const batasStok=5;
function login(){
  let u=document.getElementById('username').value.trim();
  let p=document.getElementById('password').value.trim();
  if(users[u]&&users[u].pass===p){currentUser={name:u,role:users[u].role};
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('appSection').classList.remove('hidden');
    document.getElementById('userInfo').innerText=`Login sebagai: ${u} (${currentUser.role})`;
    updateTabel();updateLog();renderCharts();}
  else document.getElementById('loginError').classList.remove('hidden');
}
function showTab(tab){
  ['home','masuk','keluar'].forEach(t=>{
    document.getElementById(t+'Tab').classList.add('hidden');
    document.getElementById('tab-'+t).classList.remove('active');});
  document.getElementById(tab+'Tab').classList.remove('hidden');
  document.getElementById('tab-'+tab).classList.add('active');
}
function simpan(){localStorage.setItem('stokBarang',JSON.stringify(stok));localStorage.setItem('logTransaksi',JSON.stringify(logTransaksi));}
function tambahBarang(isMasuk){
  if(currentUser.role!=="Admin"){alert("Hanya Admin yang bisa menambah!");return;}
  const nama=(isMasuk?inputNama:outputNama).value.trim();
  const jumlah=parseInt(isMasuk?inputJumlah.value:outputJumlah.value);
  if(!nama||isNaN(jumlah)||jumlah<=0){alert("Isi data dengan benar!");return;}
  if(!stok[nama])stok[nama]=0;
  if(isMasuk)stok[nama]+=jumlah;
  else{if(stok[nama]<jumlah){alert("Stok tidak cukup!");return;}stok[nama]-=jumlah;}
  logTransaksi.unshift({waktu:new Date().toLocaleString(),jenis:isMasuk?"Masuk":"Keluar",nama,jumlah});
  simpan();updateTabel();updateLog();renderCharts();
  if(isMasuk){inputNama.value="";inputJumlah.value="";}else{outputNama.value="";outputJumlah.value="";}
}
function undoTransaksi(){
  if(currentUser.role!=="Admin"){alert("Hanya Admin!");return;}
  if(logTransaksi.length===0){alert("Tidak ada transaksi!");return;}
  let last=logTransaksi.shift();
  if(last.jenis==="Masuk")stok[last.nama]-=last.jumlah;
  else stok[last.nama]+=last.jumlah;
  if(stok[last.nama]<0)stok[last.nama]=0;
  simpan();updateTabel();updateLog();renderCharts();
}
function updateTabel(){
  const tbody=stokTableBody;tbody.innerHTML='';
  let filter=searchInput.value.toLowerCase();
  for(const[nama,jumlah]of Object.entries(stok)){
    if(filter&&!nama.toLowerCase().includes(filter))continue;
    let tr=document.createElement('tr');
    if(jumlah<batasStok)tr.classList.add('stok-rendah');
    tr.innerHTML=`<td>${nama}</td><td>${jumlah}</td><td>${jumlah<batasStok?'<span class="warning">Stok Rendah!</span>':'Cukup'}</td>`;
    tbody.appendChild(tr);
  }
  if(!tbody.innerHTML)tbody.innerHTML=`<tr><td colspan="3">Tidak ada data</td></tr>`;
}
function updateLog(){
  const body=logTableBody;body.innerHTML='';
  if(logTransaksi.length===0){body.innerHTML='<tr><td colspan="4">Belum ada transaksi</td></tr>';return;}
  let s=filterStart.value?new Date(filterStart.value):null;
  let e=filterEnd.value?new Date(filterEnd.value):null;
  for(const log of logTransaksi){
    let lw=new Date(log.waktu);if(s&&lw<s)continue;if(e&&lw>e)continue;
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${log.waktu}</td><td>${log.jenis==="Masuk"?"üü¢":"üî¥"} ${log.jenis}</td><td>${log.nama}</td><td>${log.jumlah}</td>`;
    body.appendChild(tr);
  }
}
function exportCSV(){
  let rows=[["Waktu","Jenis","Nama","Jumlah"],...logTransaksi.map(l=>[l.waktu,l.jenis,l.nama,l.jumlah])];
  let csv=rows.map(r=>r.join(",")).join("\n");
  let blob=new Blob([csv],{type:"text/csv"});let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);a.download="transaksi.csv";a.click();
}
function exportExcel(){
  let table="<table><tr><th>Waktu</th><th>Jenis</th><th>Nama</th><th>Jumlah</th></tr>";
  logTransaksi.forEach(l=>{table+=`<tr><td>${l.waktu}</td><td>${l.jenis}</td><td>${l.nama}</td><td>${l.jumlah}</td></tr>`;});
  table+="</table>";let blob=new Blob([table],{type:"application/vnd.ms-excel"});
  let a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="transaksi.xls";a.click();
}
let stokChart,masukChart;
function renderCharts(){
  let ctx=document.getElementById("stokChart").getContext("2d");
  if(stokChart)stokChart.destroy();
  stokChart=new Chart(ctx,{type:"bar",data:{labels:Object.keys(stok),datasets:[{label:"Stok",data:Object.values(stok),backgroundColor:"#3498db"}]}});
  let ctx2=document.getElementById("masukChart").getContext("2d");
  if(masukChart)masukChart.destroy();
  let masuk=logTransaksi.filter(l=>l.jenis==="Masuk").reduce((a,c)=>{a[c.nama]=(a[c.nama]||0)+c.jumlah;return a;},{}); 
  masukChart=new Chart(ctx2,{type:"pie",data:{labels:Object.keys(masuk),datasets:[{data:Object.values(masuk),backgroundColor:["#1abc9c","#e74c3c","#9b59b6","#f39c12","#2ecc71"]}]}})
}
</script>
</body>
</html>


